/*!
 * maptalks.routeplayer v0.1.3
 * LICENSE : MIT
 * (c) 2016-2020 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],e):e(t.maptalks=t.maptalks||{},t.maptalks)}(this,function(t,o){"use strict";function e(){this.__data__=[],this.size=0}var c=function(t,e){return t===e||t!=t&&e!=e};var i=function(t,e){for(var r=t.length;r--;)if(c(t[r][0],e))return r;return-1},n=Array.prototype.splice;function r(t){var e=this.__data__,r=i(e,t);return!(r<0)&&(r==e.length-1?e.pop():n.call(e,r,1),--this.size,!0)}function s(t){var e=this.__data__,r=i(e,t);return r<0?void 0:e[r][1]}function a(t){return-1<i(this.__data__,t)}function u(t,e){var r=this.__data__,n=i(r,t);return n<0?(++this.size,r.push([t,e])):r[n][1]=e,this}function p(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}p.prototype.clear=e,p.prototype.delete=r,p.prototype.get=s,p.prototype.has=a,p.prototype.set=u;var l=p;function f(){this.__data__=new l,this.size=0}function h(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r}function d(t){return this.__data__.get(t)}function y(t){return this.__data__.has(t)}var v="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function g(t,e){return t(e={exports:{}},e.exports),e.exports}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b=function(t,e,r){return e&&S(t.prototype,e),r&&S(t,r),t};function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function j(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}function w(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var O="object"==m(v)&&v&&v.Object===Object&&v,R="object"==("undefined"==typeof self?"undefined":m(self))&&self&&self.Object===Object&&self,x=O||R||Function("return this")(),T=x.Symbol,P=Object.prototype,C=P.hasOwnProperty,k=P.toString,D=T?T.toStringTag:void 0;var E=function(t){var e=C.call(t,D),r=t[D];try{var n=!(t[D]=void 0)}catch(t){}var o=k.call(t);return n&&(e?t[D]=r:delete t[D]),o},M=Object.prototype.toString;var A=function(t){return M.call(t)},F=T?T.toStringTag:void 0;var I=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":(F&&F in Object(t)?E:A)(t)};var z=function(t){var e=void 0===t?"undefined":m(t);return null!=t&&("object"==e||"function"==e)};var U,L=function(t){if(!z(t))return!1;var e=I(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},B=x["__core-js_shared__"],q=(U=/[^.]+$/.exec(B&&B.keys&&B.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"";var $=function(t){return!!q&&q in t},N=Function.prototype.toString;var H=function(t){if(null!=t){try{return N.call(t)}catch(t){}try{return t+""}catch(t){}}return""},V=/^\[object .+?Constructor\]$/,W=Function.prototype,Y=Object.prototype,Z=W.toString,X=Y.hasOwnProperty,G=RegExp("^"+Z.call(X).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var J=function(t){return!(!z(t)||$(t))&&(L(t)?G:V).test(H(t))};var K=function(t,e){return null==t?void 0:t[e]};var Q=function(t,e){var r=K(t,e);return J(r)?r:void 0},tt=Q(x,"Map"),et=Q(Object,"create");function rt(){this.__data__=et?et(null):{},this.size=0}function nt(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var ot=Object.prototype.hasOwnProperty;function it(t){var e=this.__data__;if(et){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return ot.call(e,t)?e[t]:void 0}var st=Object.prototype.hasOwnProperty;function at(t){var e=this.__data__;return et?void 0!==e[t]:st.call(e,t)}function ut(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=et&&void 0===e?"__lodash_hash_undefined__":e,this}function pt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}pt.prototype.clear=rt,pt.prototype.delete=nt,pt.prototype.get=it,pt.prototype.has=at,pt.prototype.set=ut;var lt=pt;var ct=function(t){var e=void 0===t?"undefined":m(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ft=function(t,e){var r=t.__data__;return ct(e)?r["string"==typeof e?"string":"hash"]:r.map};function ht(t){var e=ft(this,t).delete(t);return this.size-=e?1:0,e}function dt(t){return ft(this,t).get(t)}function yt(t){return ft(this,t).has(t)}function vt(t,e){var r=ft(this,t),n=r.size;return r.set(t,e),this.size+=r.size==n?0:1,this}function gt(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var n=t[e];this.set(n[0],n[1])}}gt.prototype.clear=function(){this.size=0,this.__data__={hash:new lt,map:new(tt||l),string:new lt}},gt.prototype.delete=ht,gt.prototype.get=dt,gt.prototype.has=yt,gt.prototype.set=vt;var _t=gt;function mt(t,e){var r=this.__data__;if(r instanceof l){var n=r.__data__;if(!tt||n.length<199)return n.push([t,e]),this.size=++r.size,this;r=this.__data__=new _t(n)}return r.set(t,e),this.size=r.size,this}function bt(t){var e=this.__data__=new l(t);this.size=e.size}bt.prototype.clear=f,bt.prototype.delete=h,bt.prototype.get=d,bt.prototype.has=y,bt.prototype.set=mt;var St=bt;function jt(t){return this.__data__.has(t)}function wt(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new _t;++e<r;)this.add(t[e])}wt.prototype.add=wt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},wt.prototype.has=jt;var Ot=wt;var Rt=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n;)if(e(t[r],r,t))return!0;return!1};var xt=function(t,e){return t.has(e)};var Tt=function(t,e,r,n,o,i){var s=1&r,a=t.length,u=e.length;if(a!=u&&!(s&&a<u))return!1;var p=i.get(t);if(p&&i.get(e))return p==e;var l=-1,c=!0,f=2&r?new Ot:void 0;for(i.set(t,e),i.set(e,t);++l<a;){var h=t[l],d=e[l];if(n)var y=s?n(d,h,l,e,t,i):n(h,d,l,t,e,i);if(void 0!==y){if(y)continue;c=!1;break}if(f){if(!Rt(e,function(t,e){if(!xt(f,e)&&(h===t||o(h,t,r,n,i)))return f.push(e)})){c=!1;break}}else if(h!==d&&!o(h,d,r,n,i)){c=!1;break}}return i.delete(t),i.delete(e),c},Pt=x.Uint8Array;function Ct(t){var r=-1,n=Array(t.size);return t.forEach(function(t,e){n[++r]=[e,t]}),n}function kt(t){var e=-1,r=Array(t.size);return t.forEach(function(t){r[++e]=t}),r}var Dt=T?T.prototype:void 0,Et=Dt?Dt.valueOf:void 0;var Mt=function(t,e,r,n,o,i,s){switch(r){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return t.byteLength==e.byteLength&&i(new Pt(t),new Pt(e))?!0:!1;case"[object Boolean]":case"[object Date]":case"[object Number]":return c(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=Ct;case"[object Set]":var u=1&n;if(a=a||kt,t.size!=e.size&&!u)return!1;var p=s.get(t);if(p)return p==e;n|=2,s.set(t,e);var l=Tt(a(t),a(e),n,o,i,s);return s.delete(t),l;case"[object Symbol]":if(Et)return Et.call(t)==Et.call(e)}return!1};var At=function(t,e){for(var r=-1,n=e.length,o=t.length;++r<n;)t[o+r]=e[r];return t},Ft=Array.isArray;var It=function(t,e,r){var n=e(t);return Ft(t)?n:At(n,r(t))};var zt=function(t,e){for(var r=-1,n=null==t?0:t.length,o=0,i=[];++r<n;){var s=t[r];e(s,r,t)&&(i[o++]=s)}return i};function Ut(){return[]}var Lt=Object.prototype.propertyIsEnumerable,Bt=Object.getOwnPropertySymbols,qt=Bt?function(e){return null==e?[]:(e=Object(e),zt(Bt(e),function(t){return Lt.call(e,t)}))}:Ut;var $t=function(t,e){for(var r=-1,n=Array(t);++r<t;)n[r]=e(r);return n};var Nt=function(t){return null!=t&&"object"==(void 0===t?"undefined":m(t))};var Ht=function(t){return Nt(t)&&"[object Arguments]"==I(t)},Vt=Object.prototype,Wt=Vt.hasOwnProperty,Yt=Vt.propertyIsEnumerable,Zt=Ht(function(){return arguments}())?Ht:function(t){return Nt(t)&&Wt.call(t,"callee")&&!Yt.call(t,"callee")};function Xt(){return!1}var Gt=g(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r?x.Buffer:void 0,i=(o?o.isBuffer:void 0)||Xt;t.exports=i}),Jt=/^(?:0|[1-9]\d*)$/;var Kt=function(t,e){var r=void 0===t?"undefined":m(t);return!!(e=null==e?9007199254740991:e)&&("number"==r||"symbol"!=r&&Jt.test(t))&&-1<t&&t%1==0&&t<e};var Qt=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},te={};te["[object Float32Array]"]=te["[object Float64Array]"]=te["[object Int8Array]"]=te["[object Int16Array]"]=te["[object Int32Array]"]=te["[object Uint8Array]"]=te["[object Uint8ClampedArray]"]=te["[object Uint16Array]"]=te["[object Uint32Array]"]=!0,te["[object Arguments]"]=te["[object Array]"]=te["[object ArrayBuffer]"]=te["[object Boolean]"]=te["[object DataView]"]=te["[object Date]"]=te["[object Error]"]=te["[object Function]"]=te["[object Map]"]=te["[object Number]"]=te["[object Object]"]=te["[object RegExp]"]=te["[object Set]"]=te["[object String]"]=te["[object WeakMap]"]=!1;function ee(t){return Nt(t)&&Qt(t.length)&&!!te[I(t)]}var re=function(e){return function(t){return e(t)}},ne=g(function(t,e){var r=e&&!e.nodeType&&e,n=r&&t&&!t.nodeType&&t,o=n&&n.exports===r&&O.process,i=function(){try{var t=n&&n.require&&n.require("util").types;return t?t:o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}),oe=ne&&ne.isTypedArray,ie=oe?re(oe):ee,se=Object.prototype.hasOwnProperty;var ae=function(t,e){var r=Ft(t),n=!r&&Zt(t),o=!r&&!n&&Gt(t),i=!r&&!n&&!o&&ie(t),s=r||n||o||i,a=s?$t(t.length,String):[],u=a.length;for(var p in t)!e&&!se.call(t,p)||s&&("length"==p||o&&("offset"==p||"parent"==p)||i&&("buffer"==p||"byteLength"==p||"byteOffset"==p)||Kt(p,u))||a.push(p);return a},ue=Object.prototype;var pe=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ue)};var le=function(e,r){return function(t){return e(r(t))}}(Object.keys,Object),ce=Object.prototype.hasOwnProperty;var fe=function(t){if(!pe(t))return le(t);var e=[];for(var r in Object(t))ce.call(t,r)&&"constructor"!=r&&e.push(r);return e};var he=function(t){return null!=t&&Qt(t.length)&&!L(t)};var de=function(t){return(he(t)?ae:fe)(t)};var ye=function(t){return It(t,de,qt)},ve=Object.prototype.hasOwnProperty;var ge=function(t,e,r,n,o,i){var s=1&r,a=ye(t),u=a.length;if(u!=ye(e).length&&!s)return!1;for(var p=u;p--;){var l=a[p];if(!(s?l in e:ve.call(e,l)))return!1}var c=i.get(t);if(c&&i.get(e))return c==e;var f=!0;i.set(t,e),i.set(e,t);for(var h=s;++p<u;){var d=t[l=a[p]],y=e[l];if(n)var v=s?n(y,d,l,e,t,i):n(d,y,l,t,e,i);if(!(void 0===v?d===y||o(d,y,r,n,i):v)){f=!1;break}h=h||"constructor"==l}if(f&&!h){var g=t.constructor,_=e.constructor;g!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof _&&_ instanceof _)&&(f=!1)}return i.delete(t),i.delete(e),f},_e=Q(x,"DataView"),me=Q(x,"Promise"),be=Q(x,"Set"),Se=Q(x,"WeakMap"),je="[object Map]",we="[object Promise]",Oe="[object Set]",Re="[object WeakMap]",xe="[object DataView]",Te=H(_e),Pe=H(tt),Ce=H(me),ke=H(be),De=H(Se),Ee=I;(_e&&Ee(new _e(new ArrayBuffer(1)))!=xe||tt&&Ee(new tt)!=je||me&&Ee(me.resolve())!=we||be&&Ee(new be)!=Oe||Se&&Ee(new Se)!=Re)&&(Ee=function(t){var e=I(t),r="[object Object]"==e?t.constructor:void 0,n=r?H(r):"";if(n)switch(n){case Te:return xe;case Pe:return je;case Ce:return we;case ke:return Oe;case De:return Re}return e});var Me=Ee,Ae="[object Arguments]",Fe="[object Array]",Ie="[object Object]",ze=Object.prototype.hasOwnProperty;var Ue=function(t,e,r,n,o,i){var s=Ft(t),a=Ft(e),u=s?Fe:Me(t),p=a?Fe:Me(e),l=(u=u==Ae?Ie:u)==Ie,c=(p=p==Ae?Ie:p)==Ie,f=u==p;if(f&&Gt(t)){if(!Gt(e))return!1;l=!(s=!0)}if(f&&!l)return i=i||new St,s||ie(t)?Tt(t,e,r,n,o,i):Mt(t,e,u,r,n,o,i);if(!(1&r)){var h=l&&ze.call(t,"__wrapped__"),d=c&&ze.call(e,"__wrapped__");if(h||d)return o(h?t.value():t,d?e.value():e,r,n,i=i||new St)}return f&&(i=i||new St,ge(t,e,r,n,o,i))};var Le=function t(e,r,n,o,i){return e===r||(null==e||null==r||!Nt(e)&&!Nt(r)?e!=e&&r!=r:Ue(e,r,n,o,t,i))};var Be=function(t,e,r,n){var o=r.length,i=o,s=!n;if(null==t)return!i;for(t=Object(t);o--;){var a=r[o];if(s&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++o<i;){var u=(a=r[o])[0],p=t[u],l=a[1];if(s&&a[2]){if(void 0===p&&!(u in t))return!1}else{var c=new St;if(n)var f=n(p,l,u,t,e,c);if(!(void 0===f?Le(l,p,3,n,c):f))return!1}}return!0};var qe=function(t){return t==t&&!z(t)};var $e=function(t){for(var e=de(t),r=e.length;r--;){var n=e[r],o=t[n];e[r]=[n,o,qe(o)]}return e};var Ne=function(e,r){return function(t){return null!=t&&(t[e]===r&&(void 0!==r||e in Object(t)))}};var He=function(e){var r=$e(e);return 1==r.length&&r[0][2]?Ne(r[0][0],r[0][1]):function(t){return t===e||Be(t,e,r)}};var Ve=function(t){return"symbol"==(void 0===t?"undefined":m(t))||Nt(t)&&"[object Symbol]"==I(t)},We=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ye=/^\w*$/;var Ze=function(t,e){if(Ft(t))return!1;var r=void 0===t?"undefined":m(t);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Ve(t))||(Ye.test(t)||!We.test(t)||null!=e&&t in Object(e))},Xe="Expected a function";function Ge(o,i){if("function"!=typeof o||null!=i&&"function"!=typeof i)throw new TypeError(Xe);function s(){var t=arguments,e=i?i.apply(this,t):t[0],r=s.cache;if(r.has(e))return r.get(e);var n=o.apply(this,t);return s.cache=r.set(e,n)||r,n}return s.cache=new(Ge.Cache||_t),s}Ge.Cache=_t;var Je=Ge;var Ke=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Qe=/\\(\\)?/g,tr=function(t){var e=Je(t,function(t){return 500===r.size&&r.clear(),t}),r=e.cache;return e}(function(t){var o=[];return 46===t.charCodeAt(0)&&o.push(""),t.replace(Ke,function(t,e,r,n){o.push(r?n.replace(Qe,"$1"):e||t)}),o});var er=function(t,e){for(var r=-1,n=null==t?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o},rr=1/0,nr=T?T.prototype:void 0,or=nr?nr.toString:void 0;var ir=function t(e){if("string"==typeof e)return e;if(Ft(e))return er(e,t)+"";if(Ve(e))return or?or.call(e):"";var r=e+"";return"0"==r&&1/e==-rr?"-0":r};var sr=function(t){return null==t?"":ir(t)};var ar=function(t,e){return Ft(t)?t:Ze(t,e)?[t]:tr(sr(t))};var ur=function(t){if("string"==typeof t||Ve(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e};var pr=function(t,e){for(var r=0,n=(e=ar(e,t)).length;null!=t&&r<n;)t=t[ur(e[r++])];return r&&r==n?t:void 0};var lr=function(t,e,r){var n=null==t?void 0:pr(t,e);return void 0===n?r:n};function cr(t,e){return null!=t&&e in Object(t)}var fr=function(t,e,r){for(var n=-1,o=(e=ar(e,t)).length,i=!1;++n<o;){var s=ur(e[n]);if(!(i=null!=t&&r(t,s)))break;t=t[s]}return i||++n!=o?i:!!(o=null==t?0:t.length)&&Qt(o)&&Kt(s,o)&&(Ft(t)||Zt(t))};var hr=function(t,e){return null!=t&&fr(t,e,cr)};var dr=function(r,n){return Ze(r)&&qe(n)?Ne(ur(r),n):function(t){var e=lr(t,r);return void 0===e&&e===n?hr(t,r):Le(n,e,3)}};function yr(t){return t}var vr=function(e){return function(t){return null==t?void 0:t[e]}};var gr=function(e){return function(t){return pr(t,e)}};var _r=function(t){return Ze(t)?vr(ur(t)):gr(t)};var mr=function(t){return"function"==typeof t?t:null==t?yr:"object"==(void 0===t?"undefined":m(t))?Ft(t)?dr(t[0],t[1]):He(t):_r(t)},br=Math.floor,Sr=Math.min;var jr=function(t,e,r,n){e=r(e);for(var o=0,i=null==t?0:t.length,s=e!=e,a=null===e,u=Ve(e),p=void 0===e;o<i;){var l=br((o+i)/2),c=r(t[l]),f=void 0!==c,h=null===c,d=c==c,y=Ve(c);if(s)var v=n||d;else v=p?d&&(n||f):a?d&&f&&(n||!h):u?d&&f&&!h&&(n||!y):!h&&!y&&(n?c<=e:c<e);v?o=l+1:i=l}return Sr(i,4294967294)};var wr=function(t,e,r){return jr(t,e,mr(r,2))};var Or=function(t,e){var r=t.length;if(r)return Kt(e+=e<0?r:0,r)?t[e]:void 0},Rr=/^\s+|\s+$/g,xr=/^[-+]0x[0-9a-f]+$/i,Tr=/^0b[01]+$/i,Pr=/^0o[0-7]+$/i,Cr=parseInt;var kr=function(t){if("number"==typeof t)return t;if(Ve(t))return NaN;if(z(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=z(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(Rr,"");var r=Tr.test(t);return r||Pr.test(t)?Cr(t.slice(2),r?2:8):xr.test(t)?NaN:+t};var Dr=function(t){return t?(t=kr(t))!==1/0&&t!==-1/0?t==t?t:0:17976931348623157e292*(t<0?-1:1):0===t?t:0};var Er=function(t){var e=Dr(t),r=e%1;return e==e?r?e-r:e:0};var Mr=function(t,e){return t&&t.length?Or(t,Er(e)):void 0},Ar=(Fr.prototype.getCoordinates=function(t,e){if(t>this.getEnd())return null;var r,n,o,i,s=wr(this.path,[0,0,t],function(t){return t[2]});0===s?(r=n=this.path[s],o=i=0):(r=this.path[s-1],n=this.path[s],i=(o=t-r[2])/(n[2]-r[2]));var a=r[0]+(n[0]-r[0])*i,u=r[1]+(n[1]-r[1])*i,p=new maptalks.Coordinate(a,u),l=e.coordinateToViewPoint(p),c=e.coordinateToViewPoint(new maptalks.Coordinate(r));return{coordinate:p,viewPoint:l,degree:maptalks.Util.computeDegree(c.x,c.y,l.x,l.y),index:s,calc:0!==o}},Fr.prototype.getStart=function(){return Mr(this.path,0)[2]},Fr.prototype.getEnd=function(){return Mr(this.path,-1)[2]},Fr.prototype.getCount=function(){return this.path.length},Fr.prototype._setPath=function(t){(!t||t.length<=0)&&console.warn("path of route is empty:",t),this.path=t||[]},b(Fr,[{key:"markerSymbol",get:function(){return this.route.markerSymbol},set:function(t){this.route.markerSymbol=t,this._painter&&this._painter.marker&&this._painter.marker.setSymbol(t)}},{key:"lineSymbol",get:function(){return this.route.lineSymbol},set:function(t){this.route.lineSymbol=t,this._painter&&this._painter.marker&&this._painter.line.setSymbol(t)}}]),Fr);function Fr(t){_(this,Fr),this.route=t,this._setPath(t.path)}var Ir,zr=g(function(v){function g(t,e){for(var r=t.toString();r.length<e;)r="0"+r;return r}function _(t){return g(t,2)}function t(t,e){"string"!=typeof t&&(e=t,t=v.exports.ISO8601_FORMAT);var r,n,o,i,s=_((e=e||v.exports.now()).getDate()),a=_(e.getMonth()+1),u=_(e.getFullYear()),p=_(u.substring(2,4)),l=-1<t.indexOf("yyyy")?u:p,c=_(e.getHours()),f=_(e.getMinutes()),h=_(e.getSeconds()),d=g(e.getMilliseconds(),3),y=(r=e.getTimezoneOffset(),n=Math.abs(r),o=String(Math.floor(n/60)),i=String(n%60),1===o.length&&(o="0"+o),1===i.length&&(i="0"+i),r<0?"+"+o+i:"-"+o+i);return t.replace(/dd/g,s).replace(/MM/g,a).replace(/y{1,4}/g,l).replace(/hh/g,c).replace(/mm/g,f).replace(/ss/g,h).replace(/SSS/g,d).replace(/O/g,y)}function p(t,e,r,n){t["set"+(n?"":"UTC")+e](r)}v.exports=t,v.exports.asString=t,v.exports.parse=function(t,e,r){if(!t)throw new Error("pattern must be supplied");return function(t,e,r){var n=t.indexOf("O")<0,o=[{pattern:/y{1,4}/,regexp:"\\d{1,4}",fn:function(t,e){p(t,"FullYear",e,n)}},{pattern:/MM/,regexp:"\\d{1,2}",fn:function(t,e){p(t,"Month",e-1,n)}},{pattern:/dd/,regexp:"\\d{1,2}",fn:function(t,e){p(t,"Date",e,n)}},{pattern:/hh/,regexp:"\\d{1,2}",fn:function(t,e){p(t,"Hours",e,n)}},{pattern:/mm/,regexp:"\\d\\d",fn:function(t,e){p(t,"Minutes",e,n)}},{pattern:/ss/,regexp:"\\d\\d",fn:function(t,e){p(t,"Seconds",e,n)}},{pattern:/SSS/,regexp:"\\d\\d\\d",fn:function(t,e){p(t,"Milliseconds",e,n)}},{pattern:/O/,regexp:"[+-]\\d{3,4}|Z",fn:function(t,e){"Z"===e&&(e=0);var r=Math.abs(e),n=(0<e?-1:1)*(r%100+60*Math.floor(r/100));t.setUTCMinutes(t.getUTCMinutes()+n)}}],i=o.reduce(function(t,e){return e.pattern.test(t.regexp)?(e.index=t.regexp.match(e.pattern).index,t.regexp=t.regexp.replace(e.pattern,"("+e.regexp+")")):e.index=-1,t},{regexp:t,index:[]}),s=o.filter(function(t){return-1<t.index});s.sort(function(t,e){return t.index-e.index});var a=new RegExp(i.regexp).exec(e);if(a){var u=r||v.exports.now();return s.forEach(function(t,e){t.fn(u,a[e+1])}),u}throw new Error("String '"+e+"' could not be parsed as '"+t+"'")}(t,e,r)},v.exports.now=function(){return new Date},v.exports.ISO8601_FORMAT="yyyy-MM-ddThh:mm:ss.SSS",v.exports.ISO8601_WITH_TZ_OFFSET_FORMAT="yyyy-MM-ddThh:mm:ss.SSSO",v.exports.DATETIME_FORMAT="dd MM yyyy hh:mm:ss.SSS",v.exports.ABSOLUTETIME_FORMAT="hh:mm:ss.SSS"}).asString,Ur=o.DomUtil,Lr=Ur.createEl,Br=Ur.setClass,qr=Ur.on,$r=Ur.off,Nr=Ur.preventDefault,Hr=Ur.getEventContainerPoint,Vr=(Ir=o.control.Control,j(Wr,Ir),Wr.prototype.buildOn=function(){var t=Lr("div","tc-player");return t.innerHTML='<div class="player-btn"></div>\n      <div class="time-info">00:00</div>\n      <div class="time-slider">\n        <div class="ruler">\n          <div class="palyed"></div>\n          <div class="slider-dot"></div>\n        </div>\n      </div>\n      <div class="speed">\n        <div class="speed-info">1.0x</div>\n        <div class="speed-slider">\n          <div class="ruler">\n            <div class="slider-dot"></div>\n          </div>\n        </div>\n      </div>',this._initDomRefs(t),this.playing=!1,this.speedCtlTop=!0,t},Wr.prototype.onAdd=function(){this._bindEvents();var t=o.DomUtil.computeDomPosition(this._controlDom)[1];this.speedCtlTop=120<t,this._initSpeedDotPos(),Br(this._domRefs.speedSlider,"speed-slider "+(this.speedCtlTop?"":"bottom"))},Wr.prototype.onRemove=function(){this._offEvents()},Wr.prototype._bindEvents=function(){var t=this._domRefs;qr(t.playBtn,"click",this._onPlayBtnClick,this),qr(t.progressRuler,"click",this._onprogressRulerClick,this),qr(t.speedRuler,"click",this._onSpeedRulerClick,this),this.progressDragger=new o.DragHandler(t.progressCtlDot,{ignoreMouseleave:!0}),this.progressDragger.on("dragging",this._onprogressDotDrag,this).enable(),this.speedDragger=new o.DragHandler(t.speedCtlDot,{ignoreMouseleave:!0}),this.speedDragger.on("dragging",this._onSpeedDotDrag,this).enable(),this.options.player&&(this.options.player.on("progress",this._onProgress,this),this.options.player.on("playing",this._onPlaying,this),this.options.player.on("finished",this._onPlayFinish,this),this.options.player.on("setspeed",this._onSpeedChange,this))},Wr.prototype._offEvents=function(){var t=this._domRefs;$r(t.playBtn,"click",this._onPlayBtnClick,this),$r(t.progressRuler,"click",this._onprogressRulerClick,this),$r(t.speedRuler,"click",this._onSpeedRulerClick,this),this.progressDragger.disable(),delete this.progressDragger,this.speedDragger.disable(),delete this.speedDragger},Wr.prototype._onProgress=function(t){this._domRefs.timeInfo.innerText=zr("hh:mm:ss",new Date(t.t));var e=this._domRefs.progressRuler.clientWidth;this._domRefs.progressCtlDot.style.left=(e*t.d).toFixed(1)+"px",this._domRefs.progress.style.width=(e*t.d).toFixed(1)+"px"},Wr.prototype._onPlaying=function(){this.playing||(this.playing=!0)},Wr.prototype._onPlayFinish=function(){this.playing=!1},Wr.prototype._onPlayBtnClick=function(t){if(Nr(t),this.playing=!this._playing,this.options.player){var e=this.options.player,r=e.player.playState;"finished"==r?e.cancel().play():"running"===r?e.pause():"idle"!==r&&"paused"!=r||e.play()}},Wr.prototype._onprogressRulerClick=function(t){Nr(t);var e=Hr(t,this._domRefs.progressRuler),r=this._domRefs.progressRuler.clientWidth,n=e.x/r;this._updateprogressUI(n)},Wr.prototype._onSpeedRulerClick=function(t){Nr(t);var e=Hr(t,this._domRefs.speedRuler),r=this._domRefs.speedRuler.clientHeight,n=e.y/r;this._updateSpeedUI(n)},Wr.prototype._onprogressDotDrag=function(t){Nr(t.domEvent);var e=Hr(t.domEvent,this._domRefs.progressRuler),r=this._domRefs.progressRuler.clientWidth,n=e.x/r;this._updateprogressUI(n)},Wr.prototype._onSpeedDotDrag=function(t){Nr(t.domEvent);var e=Hr(t.domEvent,this._domRefs.speedRuler),r=this._domRefs.speedRuler.clientHeight,n=e.y/r;this._updateSpeedUI(n)},Wr.prototype._updateprogressUI=function(t){1<t&&(t=1),t<0&&(t=0);var e=(100*t).toFixed(1)+"%";this._domRefs.progress.style.width=e,this._domRefs.progressCtlDot.style.left=e,this.options.player&&this.options.player.setProgress(t)},Wr.prototype._updateSpeedUI=function(t){1<t&&(t=1),t<0&&(t=0);var e=this.speedCtlTop?1-t:t;e=((this.options.speedRange[1]-this.options.speedRange[0])*e+this.options.speedRange[0]).toFixed(1),this.options.player&&this.options.player.setSpeed(e)},Wr.prototype._onSpeedChange=function(t){var e=parseFloat(t.speed);this._domRefs.speedInfo.innerText=e.toFixed(1)+"x";var r=((e-this.options.speedRange[0])/(this.options.speedRange[1]-this.options.speedRange[0])*100).toFixed(1);this.speedCtlTop&&(r=100-r),this._domRefs.speedCtlDot.style.top=r+"%"},Wr.prototype._initSpeedDotPos=function(){var t=(1-this.options.speedRange[0])/(this.options.speedRange[1]-this.options.speedRange[0]).toFixed(1);t=this.speedCtlTop?1-t:t,t*=100,this._domRefs.speedCtlDot.style.top=t+"%"},Wr.prototype._initDomRefs=function(t){var e=t.querySelector(".player-btn"),r=t.querySelector(".time-info"),n=t.querySelector(".time-slider .ruler"),o=n.querySelector(".palyed"),i=n.querySelector(".slider-dot"),s=t.querySelector(".speed"),a=s.querySelector(".speed-info"),u=s.querySelector(".speed-slider"),p=s.querySelector(".ruler"),l=p.querySelector(".slider-dot");this._domRefs={playBtn:e,timeInfo:r,progressRuler:n,progress:o,progressCtlDot:i,speedInfo:a,speedRuler:p,speedCtlDot:l,speedSlider:u}},Wr.prototype._updatePosition=function(){var t=this.getPosition();for(var e in t=t||{top:20,left:20})t.hasOwnProperty(e)&&(o.Util.isNumber(t[e])?this.__ctrlContainer.style[e]=t[e]+"px":this.__ctrlContainer.style[e]=t[e]);this.fire("positionchange",{position:o.Util.extend({},t)})},b(Wr,[{key:"playing",set:function(t){this._playing=t,Br(this._domRefs.playBtn,"player-btn "+(t?"pause":""))},get:function(){return this._playing}}]),Wr);function Wr(){return _(this,Wr),w(this,Ir.apply(this,arguments))}Vr.mergeOptions({player:null,speedRange:[.5,60],position:{left:"50%",transform:"translateX(-50%)",bottom:"20px"}});var Yr=function(t,e,r){for(var n=-1,o=t.length;++n<o;){var i=t[n],s=e(i);if(null!=s&&(void 0===a?s==s&&!Ve(s):r(s,a)))var a=s,u=i}return u};function Zr(t,e){return e<t}var Xr=function(t){return t&&t.length?Yr(t,yr,Zr):void 0};function Gr(t,e){return t<e}var Jr,Kr=function(t){return t&&t.length?Yr(t,yr,Gr):void 0},Qr=(Jr=o.Eventable(o.Class),j(tn,Jr),tn.prototype.drawRoutesFrame=function(t,r){var n=this;t.forEach(function(t){var e=t.getCoordinates(r,n._map);console.log("playing",r,e)})},tn.prototype.play=function(){return"running"===this.player.playState||(this.player.play(),this.fire("playstart")),this},tn.prototype.pause=function(){return"paused"===this.player.playState||(this.player.pause(),this.fire("playpause")),this},tn.prototype.cancel=function(){return this.player.cancel(),this.played=0,this._createPlayer(),this._step({styles:{t:0}}),this.fire("playcancel"),this},tn.prototype.finish=function(){return"finished"===this.player.playState||(this.player.finish(),this._step({styles:{t:1}}),this.fire("playfinish")),this},tn.prototype.getCurrentTime=function(){return this.played?this.startTime+this.played:this.startTime},tn.prototype.getStartTime=function(){return this.startTime||0},tn.prototype.getEndTime=function(){return this.endTime||0},tn.prototype.setTime=function(t){return this.played=t-this.startTime,this.played<0&&(this.played=0),this.played>=this.endTime-this.startTime&&(this.played=this.endTime-this.startTime-1),this._resetPlayer(),this},tn.prototype.setProgress=function(t){t<0&&(t=0),1<t&&(t=1);var e=this.startTime+(this.endTime-this.startTime)*t;return this.setTime(e),this},tn.prototype.setSpeed=function(t){return t=parseFloat(t),this._speed=t,this._resetPlayer(),this.played==this.duration&&this.finish(),this.fire("setspeed",{speed:t}),this},tn.prototype.getSpeed=function(){return this._speed},tn.prototype.remove=function(){return this.cancel(),this.removeLayers&&this.removeLayers(),this.ctl&&this.ctl.remove(),delete this._map,this},tn.prototype._step=function(t,e){var r=this.duration*t.styles.t,n=this.startTime+r,o=!1;if(t.state&&"running"!==t.state.playState){if("finished"!==t.state.playState)return;o=!0}isNaN(n)||(this.played=r,this.drawRoutesFrame(this.routes,n),this.fire("progress",{played:r,d:t.styles.t,t:this.startTime+r}),e||this.fire("playing",{played:r,d:t.styles.t,t:this.startTime+r}),o&&(console.log("finished"),this.fire("finished")))},tn.prototype._createPlayer=function(){var t=(this.duration-this.played)/(this.options.unitTime*this._speed),e=void 0,r=this._map._getRenderer();r.callInFrameLoop&&(e=function(t){r.callInFrameLoop(t)}),this.player=o.animation.Animation.animate({t:[this.played/this.duration,1]},{framer:e,speed:t,easing:"linear"},this._step.bind(this))},tn.prototype._resetPlayer=function(){var t=this.player&&"running"===this.player.playState,e=this.played;t&&this.player.pause(),t?(this.played=e,this._createPlayer(),this.player.play()):(this._createPlayer(),this._step({styles:{t:this.played/this.duration}},!0))},tn.prototype._setup=function(t){var e=t.map(function(t){return new Ar(t)}),r=Kr(e.map(function(t){return t.getStart()})),n=Xr(e.map(function(t){return t.getEnd()}));this.routes=e,this.startTime=r,this.endTime=n,this.played=0,this.duration=n-r},tn.prototype._createControl=function(){this.options.showControl&&(console.log("create route player control"),(this.options.controlOptions.player=this).ctl=new Vr(this.options.controlOptions).addTo(this._map))},tn);function tn(t,e,r){_(this,tn);var n=w(this,Jr.call(this,r));return Array.isArray(t)||(t=[t]),n.id=o.Util.UID(),n._map=e,n._setup(t),n._speed=1,n._createPlayer(),n._createControl(),n.createLayers&&n.createLayers(),n}Qr.mergeOptions({unitTime:1,showControl:!0,controlOptions:{position:"bottom-left"},markerSymbol:null,lineSymbol:{lineWidth:1,lineColor:"steelblue"}});var en,rn=(j(nn,en=Qr),nn.prototype.drawRoutesFrame=function(t,e){var r=this;t.forEach(function(t){return r.drawRoute(t,e)})},nn.prototype.drawRoute=function(t,e){if(this._map){var r=t.getCoordinates(e,this._map);if(r){t._painter||(t._painter={});var n=t.path.slice(0,r.index);if(n.push(r.coordinate),t._painter.line)t._painter.line.setCoordinates(n);else{var o=new maptalks.LineString(n,{symbol:t.lineSymbol||this.options.lineSymbol}).addTo(this.lineLayer);t._painter.line=o}}else t._painter&&t._painter.line&&(e<=t.getStart()?t._painter.line.setCoordinates([]):e>=t.getEnd()&&t._painter.line.setCoordinates(t.path))}},nn.prototype.createLayers=function(){this.lineLayer=new maptalks.VectorLayer(maptalks.INTERNAL_LAYER_PREFIX+"_v_routeplay_l_"+this.id).addTo(this._map)},nn.prototype.removeLayers=function(){this.lineLayer.remove()},nn);function nn(){return _(this,nn),w(this,en.apply(this,arguments))}t.BaseRoutePlayer=Qr,t.VectorRoutePlayer=rn,t.RoutePlayerControl=Vr,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.routeplayer v0.1.3, requires maptalks@>=0.31.0.")});